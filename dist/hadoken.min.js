!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.Hadoken=n():t.Hadoken=n()}(window,function(){return function(t){var n={};function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var i in t)e.d(r,i,function(n){return t[n]}.bind(null,i));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=0)}([function(t,n,e){t.exports=e(1)},function(t,n,e){"use strict";e.r(n);var r={};e.r(r),e.d(r,"Events",function(){return m}),e.d(r,"Hadoken",function(){return k}),e.d(r,"NewHadoken",function(){return b}),e.d(r,"MaybeBatchUpdate",function(){return w}),e.d(r,"MaybeAddKey",function(){return x}),e.d(r,"MaybeRemoveKey",function(){return O}),e.d(r,"HadokenPause",function(){return H}),e.d(r,"HadokenResume",function(){return M}),e.d(r,"HadokenDataClear",function(){return j}),e.d(r,"curKeys",function(){return S});var i={};e.r(i),e.d(i,"Hadoken",function(){return _});var o={};e.r(o),e.d(o,"isStandardMapping",function(){return P}),e.d(o,"mkButtonInput",function(){return A}),e.d(o,"mkTriggerInput",function(){return C}),e.d(o,"mkStandardLeftStickInput",function(){return E}),e.d(o,"mkStandardRightStickInput",function(){return R}),e.d(o,"mkStandardStickInput",function(){return I}),e.d(o,"mkStickInput",function(){return T}),e.d(o,"mkBasicStickDpadMapper",function(){return B});var a={};e.r(a),e.d(a,"Hadoken",function(){return N}),e.d(a,"isStick",function(){return U}),e.d(a,"isTrigger",function(){return z}),e.d(a,"isDigital",function(){return K});var u={};e.r(u),e.d(u,"NewChain",function(){return X}),e.d(u,"CoalesseInputs",function(){return q}),e.d(u,"OnlyMostRecent",function(){return G}),e.d(u,"MapToFacing",function(){return W});var c={};e.r(c),e.d(c,"NewSimpleMapper",function(){return Y});var s={};e.r(s),e.d(s,"OneWithPrefix",function(){return J}),e.d(s,"NoneWithPrefix",function(){return Q}),e.d(s,"All",function(){return V});var f={};e.r(f),e.d(f,"New",function(){return nt});var d={};e.r(d),e.d(d,"Standard360",function(){return it}),e.d(d,"StandardPS",function(){return ot}),e.d(d,"StandardSNES",function(){return at}),e.d(d,"default",function(){return ut});var l={};e.r(l),e.d(l,"default",function(){return ct});var p=function(){return(p=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)};function h(t,n,e){var r={timestamp:t.timestamp,state:p({},t.state)};return t.state[n]?(r.state[e]=t.state[n],delete r.state[n],r):r}function y(t,n){var e=n.reduce(function(t,n){var e;return p({},t,((e={})[n]=!0,e))},{}),r=t.reduce(function(t,n){var r;return e[n]?t:p({},t,((r={})[n]=!0,r))},{});return Object.keys(r)}function v(t,n){var e=Object.keys(t.state);return y(Object.keys(n.state),e)}var g=function(){return(g=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)},m={InputUpdate:"inputupdate",Match:"match"},k=function(){function t(t,n,e){void 0===e&&(e=null),this.hadokenData=b(t,n,e),this.emitter=this.hadokenData.emitter}return t.prototype.pause=function(){H(this.hadokenData)},t.prototype.resume=function(){M(this.hadokenData)},t.prototype.clear=function(){j(this.hadokenData)},t.prototype.pressed=function(){return 0===this.hadokenData.processedHistory.length?[]:Object.keys(this.hadokenData.processedHistory.slice(-1)[0].state)},t}();function b(t,n,e){var r={scene:t,config:n,sync:e,matchedMove:null,emitter:new Phaser.Events.EventEmitter,isPaused:!1,rawHistory:[],processedHistory:[]};return t.events.on("preupdate",function(t){var n=function(n,e){if(""!==n[0])return n;var r=e.match(t.processedHistory),i=r[0],o=r[1];return i?[e.name,o]:n},e=function(){if(0!==t.processedHistory.length){var n=t.processedHistory.slice(-2),e=n.length<2?[{timestamp:0,state:{}},n[0]]:n,r=e[0],i=e[1],o=v(r,i),a=function(t,n){return y(Object.keys(t.state),Object.keys(n.state))}(r,i);(o.length||a.length)&&t.emitter.emit(m.InputUpdate,{add:o,removed:a})}},r=function(n){if(null!==n&&""!==n[0]){var e=n[1]?{meta:n[1]}:null;t.matchedMove=n[0],t.emitter.emit(m.Match,g({name:n[0]},e))}};return function(){t.sync&&t.sync(t),t.matchedMove=null;for(var i=t.processedHistory.length;i<t.rawHistory.length;i++){var o=t.rawHistory[i],a=t.config.filters,u=a?a(o):o;t.processedHistory.push(u);var c=t.config.matchers||[];t.isPaused||(e(),r(c.reduce(n,["",null])))}!function(t){var n=t.config.bufferLimit,e=t.rawHistory.length;if("depth"===t.config.bufferLimitType){var r=e-n;r>0&&(t.rawHistory=t.rawHistory.slice(r),t.processedHistory=t.processedHistory.slice(r))}else{for(var i=Date.now(),o=0;o<e&&!(i-t.rawHistory[o].timestamp<n);o++);0!==o&&(t.rawHistory=t.rawHistory.slice(o),t.processedHistory=t.processedHistory.slice(o))}}(t)}}(r)),r}function w(t,n,e,r){if(!t.isPaused){var i=Date.now(),o=t.rawHistory.length>0?t.rawHistory.slice(-1)[0]:{timestamp:i-1,state:{}},a=n.reduce(function(t,n){var e;return{timestamp:t.timestamp,state:g((e={},e[n]={pressed:r},e),t.state)}},{timestamp:i,state:g({},o.state)});e.forEach(function(t){-1===n.indexOf(t)&&delete a.state[t]}),function(t,n){var e=t.state,r=n.state?n.state:n,i=Object.keys(e),o=Object.keys(r);return!(i.length!==o.length||i.some(function(t){return-1===o.indexOf(t)}))}(a,o)||t.rawHistory.push(a)}}function x(t,n,e){w(t,[n],[],e)}function O(t,n){w(t,[],[n],Date.now())}function H(t){t.isPaused=!0}function M(t){t.isPaused=!1}function j(t){t.rawHistory=[],t.processedHistory=[]}function S(t,n){void 0===n&&(n=!0);var e=n?t.processedHistory:t.rawHistory;return e.length>0?Object.keys(e.slice(-1)[0].state):[]}var D=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),_=function(t){function n(n,e){var r=t.call(this,n,e)||this;return n.input.keyboard.on("keydown",r._keydown,r),n.input.keyboard.on("keyup",r._keyup,r),r}return D(n,t),n.prototype._keydown=function(t){var n=this.hadokenData.config.keymapFn(t.keyCode);n&&x(this.hadokenData,n,t.timeStamp)},n.prototype._keyup=function(t){var n=this.hadokenData.config.keymapFn(t.keyCode);n&&O(this.hadokenData,n)},n}(k),P=function(t){var n=t.pad;if(!n)return null;var e=n.mapping;return"string"==typeof e?"standard"===e:null},A=function(t,n){return{type:"digital",idx:t,mapping:n}},C=function(t,n,e,r){return{type:"trigger",idx:t,name:n,triggerMapper:e,allMapped:r}},E=function(t,n,e){return I(t,"left",n,e)},R=function(t,n,e){return I(t,"right",n,e)},I=function(t,n,e,r){if("left"===n)return T(t,0,1,1,-1,e,r);if("right"===n)return T(t,2,1,3,-1,e,r);throw new Error(t+": Unsupported stick location "+n)},T=function(t,n,e,r,i,o,a){return{type:"stick",name:t,verticalAxis:{idx:r,up:i},horizontalAxis:{idx:n,right:e},angleMapper:o,allMapped:a}},B=function(t,n){return void 0===t&&(t=.5),void 0===n&&(n=""),function(e,r){return r<t?null:e>=337.5||e<=22.5?n+"right":e>22.5&&e<67.5?n+"down+right":e>=67.5&&e<=112.5?n+"down":e>112.5&&e<157.5?n+"down+left":e>=157.5&&e<=202.5?n+"left":e>202.5&&e<247.5?n+"up+left":e>=247.5&&e<=292.5?n+"up":e>292.5&&e<337.5?n+"up+right":null}},L=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),N=function(t){function n(n,e){var r=this,i={stick:{},trigger:{}};return(r=t.call(this,n,e,function(t){return function(n){var e=n.config,r=e.gamepad,i=e.buttonMap.reduce(function(n,e){if(U(e)){if(r.axes.length>Math.max(e.verticalAxis.idx,e.horizontalAxis.idx)){var i=function(t,n){var e=n.axes[t.verticalAxis.idx],r=n.axes[t.horizontalAxis.idx].value*t.horizontalAxis.right,i=e.value*t.verticalAxis.up*-1,o=57.295827*Math.atan(i/r);r<0&&(o=180+o);o<0&&(o+=360);o>=360&&(o-=360);return o}(e,r),o=function(t,n){var e=n.axes[t.verticalAxis.idx],r=n.axes[t.horizontalAxis.idx].value*t.horizontalAxis.right,i=e.value*t.verticalAxis.up*-1;return function(t,n,e){return Math.min(Math.max(t,n),e)}(Math.sqrt(r*r+i*i),0,1)}(e,r);t.stick[e.name]={angle:i,value:o};var a=e.angleMapper(i,o),u=e.allMapped.filter(function(t){return null===a||t!==a});return[n[0].concat(null!==a?[a]:[]),n[1].concat(u)]}return t.stick[e.name]={angle:0,value:0},[n[0],n[1].concat(e.allMapped)]}if(z(e)){if(r.buttons.length>e.idx){var o=r.buttons[e.idx].value||0;t.trigger[e.name]=o;var c=e.triggerMapper(o),u=e.allMapped.filter(function(t){return null===c||t!==c});return[n[0].concat(null!==c?[c]:[]),n[1].concat(u)]}return t.trigger[e.name]=0,[n[0],n[1].concat(e.allMapped)]}if(K(e)&&r.buttons.length>e.idx){var s=r.buttons[e.idx].pressed;return s?[n[0].concat([e.mapping]),n[1]]:[n[0],n[1].concat([e.mapping])]}return console.error("Unhandled button definition: "+JSON.stringify(e)),n},[[],[]]),o=i[0],a=i[1];w(n,o,a,r.timestamp)}}(i))||this).analogData=i,r}return L(n,t),n.prototype.isStandardMapping=function(){return P(this.hadokenData.config.gamepad)},n}(k);function U(t){return"stick"===t.type}function z(t){return"trigger"===t.type}function K(t){return"digital"===t.type}var F=function(){return(F=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)};function X(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return function(n){return t.reduce(function(t,n){return n(t)},n)}}function q(t){return function(n){var e=F({},n.state);return Object.keys(t).forEach(function(n){if(function(t){return t.every(function(t){return!!e[t]})}(t[n])){var r=0;t[n].forEach(function(t){e[t].pressed>r&&(r=e[t].pressed),delete e[t]}),e[n]={pressed:r}}}),{timestamp:n.timestamp,state:e}}}function G(t){var n={};return t.forEach(function(t){n[t]=!0}),function(e){var r={timestamp:e.timestamp,state:{}};Object.keys(e.state).filter(function(t){return!n[t]}).forEach(function(t){r.state[t]=e.state[t]});var i=t.reduce(function(t,n){return e.state[n]&&(null===t||t[1]<e.state[n].pressed)?[n,e.state[n].pressed]:t},null);if(null!==i){var o=i[0];r.state[o]=e.state[o]}return r}}function W(t){return function(n){var e=t(),r=F({},n,{state:F({},n.state)});return r="right"===e?h(r=h(r=h(r=h(r=h(r=h(r,"right","forward"),"down+right","down+forward"),"up+right","up+forward"),"left","backward"),"down+left","down+backward"),"up+left","up+backward"):h(r=h(r=h(r=h(r=h(r=h(r,"left","forward"),"down+left","down+forward"),"up+left","up+forward"),"right","backward"),"down+right","down+backward"),"up+right","up+backward")}}function Y(t){return function(n){return t[n]||null}}function J(t){return function(n,e){var r=n[e].state;return 1===Object.keys(r).filter(function(n){return 0===n.indexOf(t)}).length}}function Q(t){return function(n,e){var r=n[e].state;return 0===Object.keys(r).filter(function(n){return 0===n.indexOf(t)}).length}}function V(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return function(n,e){return t.reduce(function(t,r){return!!t&&("string"==typeof r?function(t,n){return!!t.state[n]}(n[e],r):r(n,e))},!0)}}function Z(t,n,e){return"string"==typeof t?-1!==function(t,n){for(var e=0;e<t.length;e++)if(t[e]==n)return e;return-1}(v(0==e?{timestamp:0,state:{}}:n[e-1],n[e]),t):t(n,e)}var $={stepDelay:250,totalDelay:3e3};function tt(t,n,e){void 0===e&&(e=$);var r=e.stepDelay,i=e.totalDelay;if(!(t&&t.length&&n&&n.length))return null;var o=n[0],a=t.length-1,u=t[a].timestamp,c=u,s=[];if(!Z(o,t,a))return null;s.push(a),a--;for(var f=!0,d=1;f&&d<n.length;d++)for(o=n[d];a>=0;a--){var l=t[a].timestamp;if(!(f=!(u-l>i||c-l>r)))break;if(Z(o,t,a)){s.push(a),c=l;break}}return s.length==n.length?s:null}function nt(t,n){if(void 0===n&&(n=$),0===t.length)return function(){return[!1,null]};var e=t.slice();return e.reverse(),function(t){var r=tt(t,e,n);if(null!==r)for(var i=r.slice(-1)[0];i<t.length;i++)if(null!==tt(t.slice(0,i),e,n))return[!1,null];return r?[!0,{indicies:r.reverse()}]:[!1,null]}}var et=function(){return(et=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)},rt={LeftDpad:{Up:12,Right:15,Down:13,Left:14},RightCluster:{Down:0,Right:1,Left:2,Up:3},Left:{Trigger:6,Shoulder:4,StickPress:10},Right:{Trigger:7,Shoulder:5,StickPress:11},Menu:{Select:8,Start:9,Center:16}},it=et({},rt,{RightCluster:{A:0,B:1,X:2,Y:3}}),ot=et({},rt,{RightCluster:{X:0,Circle:1,Square:2,Triangle:3}}),at=et({},rt,{RightCluster:{B:0,A:1,Y:2,X:3}}),ut=rt,ct={Filters:u,Gamepad:o,Keyboard:c,Matchers:s,SimpleMatcher:f,StandardButtons:d};n.default={Base:r,Adapters:{Gamepad:a,Keyboard:i},Common:l}}])});